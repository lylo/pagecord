<div class="space-y-6">
  <!-- Date/View Type Navigation -->
  <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0">
      <!-- View Type Buttons -->
      <div class="flex space-x-2 justify-center md:justify-start">
        <% 
          context_month = case @view_type
            when "year"
              Date.new(@date.year, Date.current.month, 1)
            else 
              @date
          end
          
          context_year = @date.beginning_of_year
        %>
        <%= link_to admin_analytics_path(view_type: "month", date: context_month.strftime("%Y-%m")),
            class: "px-4 py-2 text-sm font-medium rounded-lg transition-colors #{@view_type == 'month' ? 'bg-slate-800 dark:bg-slate-700 text-white hover:bg-slate-700 dark:hover:bg-slate-600' : 'bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700'}" do %>
          Month
        <% end %>
        <%= link_to admin_analytics_path(view_type: "year", date: context_year.strftime("%Y")),
            class: "px-4 py-2 text-sm font-medium rounded-lg transition-colors #{@view_type == 'year' ? 'bg-slate-800 dark:bg-slate-700 text-white hover:bg-slate-700 dark:hover:bg-slate-600' : 'bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700'}" do %>
          Year
        <% end %>
      </div>

      <!-- Date Navigation -->
      <div class="flex justify-center items-center space-x-3">
        <% if @view_type == "month" %>
          <%= link_to admin_analytics_path(view_type: @view_type, date: (@date - 1.month).strftime("%Y-%m")), 
              class: "p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" do %>
            <%= inline_svg_tag "icons/chevron-left.svg", class: "w-4 h-4" %>
          <% end %>
          
          <span class="text-sm font-medium text-slate-900 dark:text-slate-100 min-w-[8rem] text-center">
            <%= @date.strftime("%B %Y") %>
          </span>
          
          <%= link_to admin_analytics_path(view_type: @view_type, date: (@date + 1.month).strftime("%Y-%m")), 
              class: "p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" do %>
            <%= inline_svg_tag "icons/chevron-right.svg", class: "w-4 h-4" %>
          <% end %>
        <% else %>
          <%= link_to admin_analytics_path(view_type: @view_type, date: (@date - 1.year).strftime("%Y")), 
              class: "p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" do %>
            <%= inline_svg_tag "icons/chevron-left.svg", class: "w-4 h-4" %>
          <% end %>
          
          <span class="text-sm font-medium text-slate-900 dark:text-slate-100 min-w-[8rem] text-center">
            <%= @date.strftime("%Y") %>
          </span>
          
          <%= link_to admin_analytics_path(view_type: @view_type, date: (@date + 1.year).strftime("%Y")), 
              class: "p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" do %>
            <%= inline_svg_tag "icons/chevron-right.svg", class: "w-4 h-4" %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <%
    date_subtitle = @view_type == "month" ? @date.strftime("%B %Y") : @date.strftime("%Y")

    post_items = @top_posts.map do |data|
      { name: data[:post].display_title, url: post_url(data[:post]),
        subtitle: blog_home_url(data[:post].blog), subtitle_url: blog_home_url(data[:post].blog),
        count: data[:count] }
    end

    page_items = @top_pages.map do |data|
      { name: data[:post].display_title, url: post_url(data[:post]),
        subtitle: blog_home_url(data[:post].blog), subtitle_url: blog_home_url(data[:post].blog),
        count: data[:count] }
    end

    blog_items = @top_blogs.map do |data|
      { name: data[:blog].display_name, url: blog_home_url(data[:blog]),
        subtitle: blog_home_url(data[:blog]), subtitle_url: blog_home_url(data[:blog]),
        count: data[:count] }
    end

    subscriber_items = @top_blogs_by_subscribers.map do |data|
      { name: data[:blog].display_name, url: blog_home_url(data[:blog]),
        subtitle: blog_home_url(data[:blog]), subtitle_url: blog_home_url(data[:blog]),
        count: data[:count] }
    end

    trending_items = @trending_posts.map do |data|
      { name: data[:post].display_title, url: post_url(data[:post]),
        subtitle: blog_home_url(data[:post].blog), subtitle_url: blog_home_url(data[:post].blog),
        meta: "#{time_ago_in_words(data[:post].published_at)} ago · #{data[:views]} views · #{data[:upvotes]} upvotes",
        count: data[:score].round(1) }
    end
  %>

  <%= render "leaderboard", title: "Top posts", subtitle: date_subtitle, items: post_items, empty_message: "No posts found" %>
  <%= render "leaderboard", title: "Top pages", subtitle: date_subtitle, items: page_items, empty_message: "No pages found" %>
  <%= render "leaderboard", title: "Top blogs", subtitle: date_subtitle, items: blog_items, empty_message: "No blogs found" %>
  <%= render "leaderboard", title: "Most email subscribers", items: subscriber_items, empty_message: "No blogs with email subscribers found" %>
  <%= render "leaderboard", title: "Trending", subtitle: "Last 14 days", items: trending_items, empty_message: "No trending posts found" %>
</div>

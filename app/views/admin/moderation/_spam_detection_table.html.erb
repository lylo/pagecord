<div class="mb-6">
  <div>
    <%= pluralize(@total_unreviewed, "blog") %> flagged for review.
  </div>
</div>

<% if @spam_detections.any? %>
  <div class="overflow-auto">
    <table class="my-8 min-w-full divide-y divide-slate-300 dark:divide-slate-700">
      <thead>
        <tr>
          <th class="py-4 pe-4 sm:ps-4 text-left text-sm font-semibold text-slate-900 dark:text-slate-50">Blog</th>
          <th class="py-4 pe-4 sm:ps-4 text-left text-sm font-semibold text-slate-900 dark:text-slate-50">Status</th>
          <th class="py-4 pe-4 sm:ps-4 text-left text-sm font-semibold text-slate-900 dark:text-slate-50">Reason</th>
          <th class="py-4 pe-4 sm:ps-4 text-left text-sm font-semibold text-slate-900 dark:text-slate-50">Detected</th>
          <th class="py-4 sm:ps-4 text-end text-sm font-semibold text-slate-900 dark:text-slate-50">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-300 dark:divide-slate-700">
        <% @spam_detections.each do |detection| %>
          <tr>
            <td class="whitespace-nowrap py-4 pe-4 sm:ps-4 text-sm font-medium text-slate-900 dark:text-slate-50">
              <%= link_to "@#{detection.blog.subdomain}",
                  admin_moderation_path(id: detection.id, type: "spam"),
                  class: "hover:underline" %>
            </td>
            <td class="whitespace-nowrap py-4 pe-4 sm:ps-4 text-sm">
              <span class="px-2 py-1 rounded <%= detection.spam? ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800' %>">
                <%= detection.status.titleize %>
              </span>
            </td>
            <td class="py-4 pe-4 sm:ps-4 text-sm text-slate-500 dark:text-slate-400 max-w-md truncate">
              <%= detection.reason.to_s.truncate(80) %>
            </td>
            <td class="whitespace-nowrap py-4 pe-4 sm:ps-4 text-sm text-slate-500 dark:text-slate-400">
              <%= detection.detected_at&.to_formatted_s(:short) %>
            </td>
            <td class="whitespace-nowrap py-4 sm:ps-4 text-end text-sm">
              <div class="flex justify-end space-x-2">
                <%= button_to "Mark Clean",
                    dismiss_spam_admin_moderation_path(id: detection.id),
                    method: :post,
                    class: "px-3 py-1 bg-green-100 hover:bg-green-200 text-green-800 rounded cursor-pointer" %>
                <%= button_to "Confirm Spam",
                    confirm_spam_admin_moderation_path(id: detection.id),
                    method: :post,
                    class: "px-3 py-1 bg-red-100 hover:bg-red-200 text-red-800 rounded cursor-pointer" %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%= render "app/shared/pagy_nav" %>
<% else %>
  <div class="text-slate-500 dark:text-slate-400 py-8">
    No blogs flagged for review.
  </div>
<% end %>
